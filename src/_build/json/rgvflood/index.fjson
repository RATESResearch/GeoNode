{"parents": [], "prev": null, "next": null, "title": "Extending GeoNodeGCP for REON.cc", "meta": {}, "body": "<section id=\"extending-geonodegcp-for-reon-cc\">\n<h1>Extending GeoNodeGCP for REON.cc<a class=\"headerlink\" href=\"#extending-geonodegcp-for-reon-cc\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p><a class=\"reference internal\" href=\"../glossary/#term-GeoNodeGCP\"><span class=\"xref std std-term\">GeoNodeGCP</span></a> is a stock implementation of <a class=\"reference internal\" href=\"../glossary/#term-0\"><span class=\"xref std std-term\">GeoNode</span></a> on <a class=\"reference internal\" href=\"../glossary/#term-GCP\"><span class=\"xref std std-term\">GCP</span></a>. <a class=\"reference internal\" href=\"../glossary/#term-REONode\"><span class=\"xref std std-term\">REONode</span></a> is a live implementation of <a class=\"reference internal\" href=\"../glossary/#term-REON.cc\"><span class=\"xref std std-term\">REON.cc</span></a> extensions and applications under active development. <a class=\"reference internal\" href=\"../glossary/#term-REONode\"><span class=\"xref std std-term\">REONode</span></a> is available online at &lt;<a class=\"reference external\" href=\"http://reonode.water-wizard.org\">http://reonode.water-wizard.org</a>&gt;.</p>\n<ol class=\"arabic\">\n<li><p>The environment variables file from <a class=\"reference internal\" href=\"../glossary/#term-GeoNodeGCP\"><span class=\"xref std std-term\">GeoNodeGCP</span></a> is adapted to reflect the specifics of <a class=\"reference internal\" href=\"../glossary/#term-REONode\"><span class=\"xref std std-term\">REONode</span></a>.</p></li>\n<li><p>The <a class=\"reference internal\" href=\"../glossary/#term-K8s\"><span class=\"xref std std-term\">K8S</span></a> manifests are adapted for <a class=\"reference internal\" href=\"../glossary/#term-REONode\"><span class=\"xref std std-term\">REONode</span></a>:</p>\n<blockquote>\n<div><ol class=\"loweralpha simple\">\n<li><p><strong>namespace.yaml</strong>: Define the reonode namespace.</p></li>\n<li><p><strong>managed-certficates.yaml</strong>: SSL Certificate definition.</p></li>\n<li><p><strong>pv.yaml</strong>: Persistent Volume definition, referring to the Google Filestore share.</p></li>\n<li><p><strong>pvc.yaml</strong>: Persistent Volume Claim, used by the containers to mount the filestore share.</p></li>\n<li><p><strong>deployment.yaml</strong>: Deploy the reonode containers</p></li>\n<li><p><strong>service.yaml</strong>:</p></li>\n<li><p><strong>ingress.yaml</strong>:</p></li>\n</ol>\n</div></blockquote>\n</li>\n<li><p>Create reonode namespace:</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">kubectl</span> <span class=\"n\">apply</span> <span class=\"o\">-</span><span class=\"n\">f</span> <span class=\"o\">/</span><span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">REONode</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">reonode</span><span class=\"o\">/</span><span class=\"n\">namespace</span><span class=\"o\">.</span><span class=\"n\">yaml</span>\n</pre></div>\n</div>\n<p>Verify creation of namespace:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">kubectl</span> <span class=\"n\">get</span> <span class=\"n\">namespaces</span>\n</pre></div>\n</div>\n<ol class=\"arabic simple\">\n<li><p>Add the cluster and context to the local kube.config. We</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">gcloud</span> <span class=\"n\">container</span> <span class=\"n\">clusters</span> <span class=\"n\">get</span><span class=\"o\">-</span><span class=\"n\">credentials</span> <span class=\"n\">waterwizard</span> <span class=\"o\">--</span><span class=\"n\">region</span> <span class=\"n\">us</span><span class=\"o\">-</span><span class=\"n\">south1</span>\n</pre></div>\n</div>\n<ol class=\"arabic simple\">\n<li><p>List the contexts:</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">kubectl</span> <span class=\"n\">config</span> <span class=\"n\">get</span><span class=\"o\">-</span><span class=\"n\">contexts</span>\n</pre></div>\n</div>\n<ol class=\"arabic simple\">\n<li><p>Rename the new context:</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">kubectl</span> <span class=\"n\">config</span> <span class=\"n\">rename</span><span class=\"o\">-</span><span class=\"n\">context</span> <span class=\"n\">gke_waterwizard_us</span><span class=\"o\">-</span><span class=\"n\">south1_waterwizard</span> <span class=\"n\">reonode</span>\n</pre></div>\n</div>\n<ol class=\"arabic simple\">\n<li><p>Add namespace to the new reonode context</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">kubectl</span> <span class=\"n\">config</span> <span class=\"nb\">set</span><span class=\"o\">-</span><span class=\"n\">context</span> <span class=\"n\">reonode</span> <span class=\"o\">--</span><span class=\"n\">namespace</span> <span class=\"n\">reonode</span>\n</pre></div>\n</div>\n<ol class=\"arabic simple\">\n<li><p>List the contexts to verify addition of the namespace:</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">kubectl</span> <span class=\"n\">config</span> <span class=\"n\">get</span><span class=\"o\">-</span><span class=\"n\">contexts</span>\n</pre></div>\n</div>\n<ol class=\"arabic simple\">\n<li><p>Use the reonode context</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">kubectl</span> <span class=\"n\">config</span> <span class=\"n\">use</span><span class=\"o\">-</span><span class=\"n\">context</span> <span class=\"n\">reonode</span>\n</pre></div>\n</div>\n<ol class=\"arabic simple\">\n<li><p>Create cloudsql-oauth-credentials (<cite>Running Django on the Google Kubernetes Engine</cite> &lt;<a class=\"reference external\" href=\"https://cloud.google.com/python/django/kubernetes-engine\">https://cloud.google.com/python/django/kubernetes-engine</a>&gt;`)</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span>kubectl create secret generic cloudsql-oauth-credentials --from-file=credentials.json=$HOME/.ssh/waterwizard-cloudsql.json --namespace reonode\n</pre></div>\n</div>\n<ol class=\"arabic\">\n<li><p>Create database secrets:</p>\n<blockquote>\n<div><p>kubectl create secret generic reonode-secrets \u2013from-env-file /data/REONode/src/reonode/.env</p>\n</div></blockquote>\n</li>\n<li><p>Create the database (reonode and reonode_data) along with the users with the passwords provided in .env</p></li>\n<li><p>Create the volumes folder to store data shared between containers:</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span>SHARED_VOLUMES=/data/REONode/volumes\nsudo rm -rf ${SHARED_VOLUMES}\nmkdir -p ${SHARED_VOLUMES}/statics/\nmkdir -p ${SHARED_VOLUMES}/geoserver_data/data\nmkdir -p ${SHARED_VOLUMES}/nginxcerts/\nmkdir -p ${SHARED_VOLUMES}/dbdata/\nmkdir -p ${SHARED_VOLUMES}/tmp/\nmkdir -p ${SHARED_VOLUMES}/dbbackups/\nmkdir -p ${SHARED_VOLUMES}/backup_restore/\nmkdir -p ${SHARED_VOLUMES}/data/\nmkdir -p ${SHARED_VOLUMES}/statics/\n\nGEOSERVER_VERSION=2.20.6\nTEMP_DOWNLOADED=${SHARED_VOLUMES}/tmp/geonode/downloaded\nARTIFACT_URL=&quot;https://artifacts.geonode.org/geoserver/$GEOSERVER_VERSION/geonode-geoserver-ext-web-app-data.zip&quot;\nBASE_GEOSERVER_DATA_DIR=${SHARED_VOLUMES}/geoserver_data\nmkdir -p $TEMP_DOWNLOADED\ncurl  -k -L &quot;$ARTIFACT_URL&quot; --output data.zip &amp;&amp; unzip -x -d ${TEMP_DOWNLOADED} data.zip\nrm data.zip\nmkdir -p ${BASE_GEOSERVER_DATA_DIR}\ncp -r ${TEMP_DOWNLOADED}/data ${BASE_GEOSERVER_DATA_DIR}\n</pre></div>\n</div>\n<ol class=\"arabic simple\">\n<li><p>Create the Google managed SSL certificate:</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">kubectl</span> <span class=\"n\">apply</span> <span class=\"o\">-</span><span class=\"n\">f</span> <span class=\"o\">/</span><span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">REONode</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">reonode</span><span class=\"o\">/</span><span class=\"n\">managed</span><span class=\"o\">-</span><span class=\"n\">certificates</span><span class=\"o\">.</span><span class=\"n\">yaml</span>\n</pre></div>\n</div>\n<ol class=\"arabic simple\">\n<li><p>Create the Kubernetes Persistent Volume for /data</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">kubectl</span> <span class=\"n\">apply</span> <span class=\"o\">-</span><span class=\"n\">f</span> <span class=\"o\">/</span><span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">REONode</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">reonode</span><span class=\"o\">/</span><span class=\"n\">pv</span><span class=\"o\">.</span><span class=\"n\">yaml</span>\n</pre></div>\n</div>\n<ol class=\"arabic simple\">\n<li><p>Create the Kubernetes Persistent Volume Claim for /data</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">kubectl</span> <span class=\"n\">apply</span> <span class=\"o\">-</span><span class=\"n\">f</span> <span class=\"o\">/</span><span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">REONode</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">reonode</span><span class=\"o\">/</span><span class=\"n\">pvc</span><span class=\"o\">.</span><span class=\"n\">yaml</span>\n</pre></div>\n</div>\n<ol class=\"arabic simple\">\n<li><p>Deploy the containers:</p></li>\n</ol>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">kubectl</span> <span class=\"n\">apply</span> <span class=\"o\">-</span><span class=\"n\">f</span> <span class=\"o\">/</span><span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">REONode</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">reonode</span><span class=\"o\">/</span><span class=\"n\">deployment</span><span class=\"o\">.</span><span class=\"n\">yaml</span>\n</pre></div>\n</div>\n</section>\n", "metatags": "<meta name=\"generator\" content=\"Docutils 0.17.1: http://docutils.sourceforge.net/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"]], "sourcename": "rgvflood/index.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Extending GeoNodeGCP for REON.cc</a></li>\n</ul>\n", "display_toc": false, "page_source_suffix": ".rst", "current_page_name": "rgvflood/index", "sidebars": ["about.html", "navigation.html", "relations.html", "searchbox.html", "donate.html", "postcard.html", "recentposts.html", "tagcloud.html", "categories.html", "archives.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.12"}